import{l as y,x as Q,i as M,A as T,q as W,r as X,c as F,o as i,w as P,b as s,h as l,e as m,t as u,u as n,F as k,z as h,d as Y,j as c,B as C,a as g,f as p,n as b,y as E,v as Z}from"./app-BFIzMVFd.js";import{_ as ee}from"./Modal-By5cnOVT.js";import{_ as j}from"./InputError-CQqX-vWw.js";import{P as ae}from"./PrimaryButton-DMpJWd03.js";import{_ as se}from"./SecondaryButton-B7RMHXRj.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const te={class:"sm:p-6 scrollbar-hide"},ne={class:"text-2xl font-bold text-gray-800 mb-6"},re={class:"mb-4 p-3 bg-blue-50 border-l-4 border-blue-500"},ie={class:"font-medium text-blue-800 text-bold"},le={key:0,class:"mb-4 p-4 bg-red-50 border-l-4 border-red-500"},oe={class:"flex"},de={class:"ml-3"},ue={class:"text-sm font-medium text-red-800"},ge={class:"mt-2 text-sm text-red-700"},me={class:"list-disc pl-5 space-y-1"},pe={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},ce=["aria-invalid","aria-describedby"],be=["aria-invalid","aria-describedby"],fe={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},_e=["aria-invalid","aria-describedby"],ve={class:"relative mt-1"},xe=["value","aria-invalid","aria-describedby"],ye=["aria-invalid","aria-describedby"],ke={key:0,class:"mt-2 space-y-2"},he={class:"flex items-center"},je={class:"text-sm truncate max-w-xs"},we={class:"text-xs text-gray-500 ml-2"},De=["onClick"],Ce={key:1,class:"mt-2"},Be={class:"flex items-center"},Se={href:"#",target:"_blank",class:"text-sm text-blue-600 hover:underline"},Ne={class:"mb-4"},Ue=["value"],Me={key:0,class:"mb-4"},Fe=["value"],Pe={key:0,class:"block font-medium"},Ee={key:1,class:"flex justify-center p-4"},Le={key:2,class:"grid grid-cols-1 gap-4"},Ve={class:"mb-3"},Te={key:0,class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Ke=["aria-disabled","onClick"],Oe={class:"font-semibold"},Ae={key:0,class:"inline-block bg-blue-100 text-xs px-2 py-0.5 rounded-full"},ze={key:1,class:"p-3 bg-red-50 rounded-md"},Ie={key:3,class:"p-3 bg-red-50 rounded-md mt-4"},$e={class:"flex justify-end space-x-3"},Xe={__name:"CreateGutulsModal",props:{show:Boolean,isEdit:Boolean,notaData:Object,skpd:Object,kegiatanOptions:Array,subKegiatanOptions:Array},emits:["close","success"],setup(f,{emit:K}){var V;const _=y([]),B=y(!1),d=f,U=K,e=Q({id:"",nomor_nota:"",perihal:"",anggaran:null,tanggal_pengajuan:"",jenis:"",parent_ids:[],skpd_id:((V=d.skpd)==null?void 0:V.id)||null,is_belanja_modal:!1,lampirans:[],deleted_files:[]}),w=y([]),v=y(""),O=M(()=>e.anggaran===null||e.anggaran===""?"":parseFloat(e.anggaran).toLocaleString("id-ID")),A=r=>{const a=r.replace(/\D/g,"");e.anggaran=a?parseInt(a):null},z=r=>{const o=Array.from(r.target.files).filter(t=>t.size>3*1024*1024?(e.setError("lampirans","Ukuran file melebihi 3MB per file."),!1):!0);o.length>0&&(e.lampirans=[...e.lampirans,...o])},I=r=>{e.lampirans.splice(r,1)},$=r=>{if(r===0)return"0 Bytes";const a=1024,o=["Bytes","KB","MB"],t=Math.floor(Math.log(r)/Math.log(a));return parseFloat((r/Math.pow(a,t)).toFixed(2))+" "+o[t]},G=()=>{const r={nomor_nota:e.nomor_nota,perihal:e.perihal,anggaran:e.anggaran,tanggal_pengajuan:e.tanggal_pengajuan,jenis:e.jenis,skpd_id:e.skpd_id,lampirans:e.lampirans,is_belanja_modal:e.is_belanja_modal,parent_ids:e.parent_ids};d.isEdit?e.transform(a=>({...r,_method:"PUT"})).post(route("update-gutuls",e.id),{onSuccess:()=>{S(),U("success")},preserveScroll:!0,forceFormData:!0}):e.transform(()=>r).post(route("store-gutuls"),{onSuccess:()=>{S(),U("success")},preserveScroll:!0,forceFormData:!0})},S=()=>{e.reset(),e.clearErrors(),e.deleted_files=[],e.lampirans=[],w.value=[],v.value="",U("close")},R=r=>{const a=_.value.find(o=>o.id===r);if(a&&a.sisa_anggaran>0){const o=e.parent_ids.indexOf(r);o===-1?e.parent_ids.push(r):e.parent_ids.splice(o,1)}},J=r=>{switch(r){case"GU":return"bg-yellow-100 text-yellow-800";case"TU":return"bg-indigo-100 text-indigo-800";case"LS":return"bg-red-100 text-red-800";default:return"bg-gray-200 text-gray-800"}},q=()=>{var r,a,o;e.reset(),e.clearErrors(),e.deleted_files=[],e.lampirans=[],w.value=[],v.value="",d.isEdit&&d.notaData?(e.id=d.notaData.id,e.nomor_nota=d.notaData.nomor_nota,e.perihal=d.notaData.perihal,e.anggaran=d.notaData.anggaran,e.tanggal_pengajuan=d.notaData.tanggal_pengajuan,e.jenis=d.notaData.jenis,e.skpd_id=d.notaData.skpd_id,e.is_belanja_modal=!!d.notaData.is_belanja_modal,e.parent_ids=((r=d.notaData.parents)==null?void 0:r.map(t=>t.id))||[],w.value=((a=d.notaData.lampirans)==null?void 0:a.map(t=>({...t})))||[]):e.skpd_id=((o=d.skpd)==null?void 0:o.id)||null};T([()=>d.show,()=>d.notaData],([r,a])=>{r&&q()},{immediate:!0,deep:!0});const N=y(""),D=y(""),H=M(()=>{var r;return((r=d.subKegiatanOptions)==null?void 0:r.filter(a=>a.kegiatan_id===N.value))||[]}),L=M(()=>{let r=_.value;if(D.value&&(r=r.filter(a=>a.sub_kegiatan_id===D.value)),v.value){const a=v.value.toLowerCase();r=r.filter(o=>o.nomor_nota.toLowerCase().includes(a)||o.perihal.toLowerCase().includes(a))}return r});return T(D,async r=>{if(r){B.value=!0;try{const{data:a}=await W.get(route("nota-induk.index",d.skpd.id),{params:{tahun:d.tahun,sub_kegiatan_id:r}});_.value=a}catch(a){console.error("Gagal mengambil parent notes:",a)}finally{B.value=!1}}else _.value=[]}),(r,a)=>{const o=X("font-awesome-icon");return i(),F(ee,{show:f.show,onClose:S,"max-width":"5xl"},{default:P(()=>[s("div",te,[s("h2",ne,u(f.isEdit?"Edit Nota Dinas":"Buat Nota Dinas"),1),s("div",re,[s("p",ie,u(f.skpd.nama_skpd),1)]),Object.keys(n(e).errors).length>0?(i(),l("div",le,[s("div",oe,[s("div",de,[s("h3",ue," Terdapat "+u(Object.keys(n(e).errors).length)+" kesalahan ",1),s("div",ge,[s("ul",me,[(i(!0),l(k,null,h(n(e).errors,(t,x)=>(i(),l("li",{key:x},u(t),1))),128))])])])])])):m("",!0),s("form",{onSubmit:Y(G,["prevent"]),class:"space-y-4"},[c(s("input",{type:"hidden","onUpdate:modelValue":a[0]||(a[0]=t=>n(e).skpd_id=t)},null,512),[[C,n(e).skpd_id]]),s("div",pe,[s("div",null,[a[11]||(a[11]=s("label",{for:"nomor_nota",class:"block font-medium"},[p("Nomor Nota"),s("span",{class:"text-red-600"},"*")],-1)),c(s("input",{id:"nomor_nota",type:"text","onUpdate:modelValue":a[1]||(a[1]=t=>n(e).nomor_nota=t),"aria-invalid":!!n(e).errors.nomor_nota,"aria-describedby":n(e).errors.nomor_nota?"nomor_nota-error":void 0,class:b(["mt-1 block w-full border rounded-md px-3 py-2 text-sm",n(e).errors.nomor_nota?"border-red-500":"border-gray-300"])},null,10,ce),[[C,n(e).nomor_nota]]),g(j,{id:"nomor_nota-error",message:n(e).errors.nomor_nota},null,8,["message"])]),s("div",null,[a[12]||(a[12]=s("label",{for:"tanggal_pengajuan",class:"block font-medium"},[p("Tanggal Pengajuan"),s("span",{class:"text-red-600"},"*")],-1)),c(s("input",{id:"tanggal_pengajuan",type:"date","onUpdate:modelValue":a[2]||(a[2]=t=>n(e).tanggal_pengajuan=t),"aria-invalid":!!n(e).errors.tanggal_pengajuan,"aria-describedby":n(e).errors.tanggal_pengajuan?"tanggal_pengajuan-error":void 0,class:b(["mt-1 block w-full border rounded-md px-3 py-2 text-sm",n(e).errors.tanggal_pengajuan?"border-red-500":"border-gray-300"])},null,10,be),[[C,n(e).tanggal_pengajuan]]),g(j,{id:"tanggal_pengajuan-error",message:n(e).errors.tanggal_pengajuan},null,8,["message"])])]),s("div",fe,[s("div",null,[a[14]||(a[14]=s("label",{for:"jenis",class:"block font-medium"},[p("Jenis Nota"),s("span",{class:"text-red-600"},"*")],-1)),c(s("select",{id:"jenis","onUpdate:modelValue":a[3]||(a[3]=t=>n(e).jenis=t),"aria-invalid":!!n(e).errors.jenis,"aria-describedby":n(e).errors.jenis?"jenis-error":void 0,class:b(["mt-1 block w-full border rounded-md px-3 py-2 text-sm",n(e).errors.jenis?"border-red-500":"border-gray-300"])},a[13]||(a[13]=[s("option",{disabled:"",value:""},"-- Pilih Jenis Nota --",-1),s("option",{value:"GU"},"GU",-1),s("option",{value:"TU"},"TU",-1),s("option",{value:"LS"},"LS",-1)]),10,_e),[[E,n(e).jenis]]),g(j,{id:"jenis-error",message:n(e).errors.jenis},null,8,["message"])]),s("div",null,[a[15]||(a[15]=s("label",{for:"anggaran",class:"block font-medium"},[p("Anggaran (Rp)"),s("span",{class:"text-red-600"},"*")],-1)),s("div",ve,[s("input",{id:"anggaran",type:"text",value:O.value,onInput:a[4]||(a[4]=t=>A(t.target.value)),"aria-invalid":!!n(e).errors.anggaran,"aria-describedby":n(e).errors.anggaran?"anggaran-error":void 0,class:b(["block w-full border rounded-md px-3 py-2 text-sm",n(e).errors.anggaran?"border-red-500":"border-gray-300"])},null,42,xe),n(e).anggaran!==null&&n(e).anggaran!==""?(i(),l("button",{key:0,type:"button",onClick:a[5]||(a[5]=t=>n(e).anggaran=null),class:"absolute inset-y-0 right-0 flex items-center pr-3 text-gray-400 hover:text-gray-600","aria-label":"Clear amount"},[g(o,{icon:"times"})])):m("",!0)]),g(j,{id:"anggaran-error",message:n(e).errors.anggaran},null,8,["message"])])]),s("div",null,[a[16]||(a[16]=s("label",{for:"perihal",class:"block font-medium"},[p("Perihal"),s("span",{class:"text-red-600"},"*")],-1)),c(s("input",{id:"perihal","onUpdate:modelValue":a[6]||(a[6]=t=>n(e).perihal=t),type:"text","aria-invalid":!!n(e).errors.perihal,"aria-describedby":n(e).errors.perihal?"perihal-error":void 0,class:b(["mt-1 block w-full border rounded-md px-3 py-2 text-sm",n(e).errors.perihal?"border-red-500":"border-gray-300"])},null,10,ye),[[C,n(e).perihal]]),g(j,{id:"perihal-error",message:n(e).errors.perihal},null,8,["message"])]),s("div",null,[c(s("input",{type:"checkbox","onUpdate:modelValue":a[7]||(a[7]=t=>n(e).is_belanja_modal=t),class:"form-checkbox h-4 w-4 text-indigo-600 rounded border-gray-300 focus:ring-indigo-500 transition duration-150 ease-in-out"},null,512),[[Z,n(e).is_belanja_modal]]),a[17]||(a[17]=s("span",{class:"text-sm text-gray-800 font-medium select-none"},[p(" Tandai sebagai "),s("span",{class:"text-indigo-600 font-semibold"},"Belanja Modal")],-1))]),s("div",null,[a[19]||(a[19]=s("label",{for:"lampirans",class:"block font-medium"},"Lampiran (opsional)",-1)),s("input",{id:"lampirans",type:"file",accept:".pdf",multiple:"",onChange:z,class:"block w-full text-sm text-gray-700 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-indigo-50 file:text-indigo-700 hover:file:bg-indigo-100"},null,32),a[20]||(a[20]=s("p",{class:"mt-1 text-xs text-gray-500"},"PDF (maks. 3MB per file)",-1)),n(e).lampirans.length>0?(i(),l("div",ke,[(i(!0),l(k,null,h(n(e).lampirans,(t,x)=>(i(),l("div",{key:x,class:"flex items-center justify-between p-2 bg-gray-50 rounded"},[s("div",he,[g(o,{icon:"file-pdf",class:"text-red-500 mr-2"}),s("span",je,u(t.name),1),s("span",we,"("+u($(t.size))+")",1)]),s("button",{type:"button",onClick:Ge=>I(x),class:"text-red-500 hover:text-red-700","aria-label":"Remove file"},[g(o,{icon:"times"})],8,De)]))),128))])):m("",!0),f.isEdit&&w.value.length?(i(),l("div",Ce,[a[18]||(a[18]=s("p",{class:"text-sm font-medium mb-1"},"File yang sudah diunggah:",-1)),(i(!0),l(k,null,h(w.value,(t,x)=>(i(),l("div",{key:t.id,class:"flex items-center justify-between p-2 bg-gray-50 rounded mb-2"},[s("div",Be,[g(o,{icon:"file-pdf",class:"text-red-500 mr-2"}),s("a",Se,u(t.nama_file),1)])]))),128))])):m("",!0)]),s("div",Ne,[a[22]||(a[22]=s("label",{for:"kegiatan",class:"block font-medium"},"Pilih Kegiatan",-1)),c(s("select",{id:"kegiatan","onUpdate:modelValue":a[8]||(a[8]=t=>N.value=t),class:"mt-1 block w-full border rounded-md px-3 py-2 text-sm border-gray-300"},[a[21]||(a[21]=s("option",{value:""},"-- Pilih Kegiatan --",-1)),(i(!0),l(k,null,h(d.kegiatanOptions,t=>(i(),l("option",{key:t.id,value:t.id},u(t.nama),9,Ue))),128))],512),[[E,N.value]])]),N.value?(i(),l("div",Me,[a[24]||(a[24]=s("label",{for:"sub_kegiatan",class:"block font-medium"},"Pilih Sub Kegiatan",-1)),c(s("select",{id:"sub_kegiatan","onUpdate:modelValue":a[9]||(a[9]=t=>D.value=t),class:"mt-1 block w-full border rounded-md px-3 py-2 text-sm border-gray-300"},[a[23]||(a[23]=s("option",{value:""},"-- Pilih Sub Kegiatan --",-1)),(i(!0),l(k,null,h(H.value,t=>(i(),l("option",{key:t.id,value:t.id},u(t.nama),9,Fe))),128))],512),[[E,D.value]])])):m("",!0),s("div",null,[_.value.length>0?(i(),l("label",Pe,u(f.isEdit?"Nota Induk":"Pilih Nota Induk (Bisa lebih dari satu)"),1)):m("",!0),B.value?(i(),l("div",Ee,[g(o,{icon:"spinner",spin:"",class:"text-blue-500 text-xl"})])):(i(),l("div",Le,[s("div",Ve,[a[25]||(a[25]=s("label",{for:"parent_notes_search",class:"sr-only"},"Cari Nota Induk",-1)),_.value.length>0?c((i(),l("input",{key:0,id:"parent_notes_search",type:"text","onUpdate:modelValue":a[10]||(a[10]=t=>v.value=t),placeholder:"Cari nomor nota atau perihal...",class:"block w-full border border-gray-300 rounded-md px-3 py-2 text-sm"},null,512)),[[C,v.value]]):m("",!0)]),L.value.length>0?(i(),l("div",Te,[(i(!0),l(k,null,h(L.value,t=>(i(),l("div",{key:t.id,"aria-disabled":t.sisa_anggaran<=0,class:b(["border rounded-md p-2 flex justify-between items-center transition",n(e).errors.parent_ids?"border-red-500":"border-gray-300",{"opacity-50 cursor-not-allowed":t.sisa_anggaran<=0,"cursor-pointer":t.sisa_anggaran>0,"bg-green-100 border-green-500":n(e).parent_ids.includes(t.id),"hover:bg-gray-50":t.sisa_anggaran>0}]),onClick:x=>R(t.id)},[s("div",null,[s("p",Oe,[p(u(t.nomor_nota)+" - "+u(t.perihal)+" ",1),s("span",{class:b(["inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium ml-2",J(t.jenis)])},u(t.jenis),3)]),s("p",{class:b(["text-sm",t.sisa_anggaran<=0?"text-red-500":"text-gray-500"])},[p(" Sisa: Rp. "+u(t.sisa_anggaran.toLocaleString("id-ID"))+" ",1),t.is_belanja_modal?(i(),l("span",Ae," Belanja Modal ")):m("",!0)],2)]),n(e).parent_ids.includes(t.id)?(i(),F(o,{key:0,icon:"check-circle",class:"text-green-600 text-lg"})):m("",!0)],10,Ke))),128))])):v.value.trim()!==""?(i(),l("div",ze,a[26]||(a[26]=[s("p",{class:"text-red-800 text-center"},"Tidak ada nota induk yang sesuai dengan pencarian Anda. ",-1)]))):m("",!0)])),_.value.length===0&&!B.value?(i(),l("div",Ie,a[27]||(a[27]=[s("p",{class:"text-red-800 text-center"},"Belum ada nota dinas induk yang tersedia. ",-1)]))):m("",!0),g(j,{message:n(e).errors.parent_ids},null,8,["message"])]),s("div",$e,[g(se,{onClick:S,disabled:n(e).processing},{default:P(()=>a[28]||(a[28]=[p(" Batal ")])),_:1},8,["disabled"]),g(ae,{class:b({"opacity-25":n(e).processing}),disabled:n(e).processing},{default:P(()=>[n(e).processing?(i(),F(o,{key:0,icon:"spinner",spin:"",class:"mr-2"})):m("",!0),p(" "+u(n(e).processing?f.isEdit?"Mengupdate...":"Menyimpan...":f.isEdit?"Update":"Simpan"),1)]),_:1},8,["class","disabled"])])],32)])]),_:1},8,["show"])}}};export{Xe as default};
