import{x as C,i as E,A as T,r as F,c as _,o as i,w as x,b as a,h as u,e as y,t as d,u as s,F as M,z as A,d as O,j as p,B as c,f as g,n as m,y as j,a as h}from"./app-BFIzMVFd.js";import{_ as I}from"./Modal-By5cnOVT.js";import{f as N}from"./formatters--Bkvj4ca.js";import{P as L}from"./PrimaryButton-DMpJWd03.js";import{_ as R}from"./SecondaryButton-B7RMHXRj.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const z={class:"sm:p-6"},G={class:"text-lg font-semibold mb-4"},K={key:0,class:"mb-4 p-3 bg-green-100 rounded-md"},$={class:"font-medium"},J={class:"text-sm text-gray-600"},W={class:"text-sm text-gray-600"},q={class:"text-sm text-red-700"},H={key:1,class:"mb-4 p-4 bg-red-50 border-l-4 border-red-500"},Q={class:"flex"},X={class:"ml-3"},Y={class:"text-sm font-medium text-red-800"},Z={class:"mt-2 text-sm text-red-700"},ee={class:"list-disc pl-5 space-y-1"},ae={class:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4"},te={class:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4"},se=["value"],oe={class:"mb-4"},ne={class:"mb-4"},re={class:"flex justify-end gap-2 pt-2"},ge={__name:"NotaModal",props:{show:Boolean,isEdit:Boolean,notaData:Object,isChild:Boolean,parentNota:Object,errors:Object,skpd:Object},emits:["close","success"],setup(l,{emit:D}){var v;const o=l,b=D,e=C({id:"",nomor_nota:"",perihal:"",anggaran:0,tanggal_pengajuan:"",jenis:"",parent_ids:[],skpd_id:((v=o.skpd)==null?void 0:v.id)||null,lampirans:[]}),w=E(()=>{const r=parseFloat(e.anggaran);return isNaN(r)?"0":r.toLocaleString("id-ID")}),S=r=>{const t=r.replace(/\D/g,"");e.anggaran=t?parseInt(t):0},U=()=>{var r,t;o.isEdit&&o.notaData?(e.id=o.notaData.id,e.nomor_nota=o.notaData.nomor_nota,e.perihal=o.notaData.perihal,e.anggaran=o.notaData.anggaran??0,e.tanggal_pengajuan=o.notaData.tanggal_pengajuan,e.jenis=o.notaData.jenis,e.parent_ids=o.notaData.dikaitkan_oleh?o.notaData.dikaitkan_oleh.map(k=>k.id):[],e.skpd_id=o.notaData.skpd_id):o.isChild&&o.parentNota?(e.reset(),e.parent_ids=[o.parentNota.id],e.skpd_id=((r=o.skpd)==null?void 0:r.id)||null,e.anggaran=0):(e.reset(),e.parent_ids=[],e.skpd_id=((t=o.skpd)==null?void 0:t.id)||null,e.anggaran=0)};T(()=>o.show,r=>{r&&U()},{immediate:!0});const P=r=>{e.lampirans=r.target.files},f=()=>{e.reset(),e.clearErrors(),b("close")},B=()=>{const r={nomor_nota:e.nomor_nota,perihal:e.perihal,anggaran:e.anggaran,tanggal_pengajuan:e.tanggal_pengajuan,jenis:e.jenis,skpd_id:e.skpd_id,lampirans:e.lampirans,parent_ids:e.parent_ids};o.isEdit?e.transform(t=>({...r,_method:"PUT"})).post(route("nota-skpd.update",e.id),{onSuccess:()=>{f(),b("success")},preserveScroll:!0,forceFormData:!0}):e.transform(()=>r).post(route("nota-skpd.store"),{onSuccess:()=>{f(),b("success")},preserveScroll:!0,forceFormData:!0})};return(r,t)=>{const k=F("font-awesome-icon");return i(),_(I,{show:l.show,onClose:f,maxWidth:"5xl"},{default:x(()=>[a("div",z,[a("h3",G,d(l.isEdit?"Edit Nota Dinas":"Buat Nota Dinas"),1),l.isChild&&l.parentNota?(i(),u("div",K,[t[8]||(t[8]=a("h4",{class:"text-sm font-medium text-gray-800 mb-1"},"Untuk Nota Dinas:",-1)),a("p",$,"No. Nota: "+d(l.parentNota.nomor_nota),1),a("p",J,"Perihal: "+d(l.parentNota.perihal),1),a("p",W,"Anggaran: Rp. "+d(s(N)(l.parentNota.anggaran)),1),a("p",q,"Sisa Anggaran: Rp. "+d(s(N)(l.parentNota.sisa_anggaran)),1)])):y("",!0),Object.keys(s(e).errors).length>0?(i(),u("div",H,[a("div",Q,[a("div",X,[a("h3",Y," Terdapat "+d(Object.keys(s(e).errors).length)+" kesalahan ",1),a("div",Z,[a("ul",ee,[(i(!0),u(M,null,A(s(e).errors,(n,V)=>(i(),u("li",{key:V},d(n),1))),128))])])])])])):y("",!0),a("form",{onSubmit:O(B,["prevent"])},[p(a("input",{type:"hidden","onUpdate:modelValue":t[0]||(t[0]=n=>s(e).skpd_id=n),name:"skpd_id"},null,512),[[c,s(e).skpd_id]]),p(a("input",{type:"hidden","onUpdate:modelValue":t[1]||(t[1]=n=>s(e).id=n)},null,512),[[c,s(e).id]]),a("div",ae,[a("div",null,[t[9]||(t[9]=a("label",{for:"nomor_nota",class:"block font-medium"},[g("Nomor Nota"),a("span",{class:"text-red-600"},"*")],-1)),p(a("input",{type:"text","onUpdate:modelValue":t[2]||(t[2]=n=>s(e).nomor_nota=n),class:m(["mt-1 block w-full border rounded-md px-3 py-2 text-sm",s(e).errors.nomor_nota?"border-red-500":"border-gray-300"])},null,2),[[c,s(e).nomor_nota]])]),a("div",null,[t[10]||(t[10]=a("label",{for:"tanggal_pengajuan",class:"block font-medium"},[g("Tanggal Pengajuan"),a("span",{class:"text-red-600"},"*")],-1)),p(a("input",{type:"date","onUpdate:modelValue":t[3]||(t[3]=n=>s(e).tanggal_pengajuan=n),class:m(["mt-1 block w-full border rounded-md px-3 py-2 text-sm",s(e).errors.tanggal_pengajuan?"border-red-500":"border-gray-300"])},null,2),[[c,s(e).tanggal_pengajuan]])])]),a("div",te,[a("div",null,[t[13]||(t[13]=a("label",{for:"jenis",class:"block font-medium"},[g("Jenis Nota"),a("span",{class:"text-red-600"},"*")],-1)),s(e).parent_ids.length===0?p((i(),u("select",{key:0,"onUpdate:modelValue":t[4]||(t[4]=n=>s(e).jenis=n),class:m(["mt-1 block w-full border rounded-md px-3 py-2 text-sm",s(e).errors.jenis?"border-red-500":"border-gray-300"])},t[11]||(t[11]=[a("option",{value:"",disabled:""},"--Pilih jenis--",-1),a("option",{value:"Perda"},"Perda",-1),a("option",{value:"Perbup"},"Perbup",-1),a("option",{value:"SK"},"SK",-1),a("option",{value:"Rekomendasi"},"Rekomendasi",-1),a("option",{value:"Surat"},"Surat",-1),a("option",{value:"Telaah"},"Telaah Staf",-1),a("option",{value:"Edaran"},"Surat Edaran",-1),a("option",{value:"Instruksi"},"Instruksi",-1)]),2)),[[j,s(e).jenis]]):p((i(),u("select",{key:1,"onUpdate:modelValue":t[5]||(t[5]=n=>s(e).jenis=n),class:m(["mt-1 block w-full border rounded-md px-3 py-2 text-sm",s(e).errors.jenis?"border-red-500":"border-gray-300"])},t[12]||(t[12]=[a("option",{value:"",disabled:""},"--Pilih jenis--",-1),a("option",{value:"GU"},"GU",-1),a("option",{value:"TU"},"TU",-1),a("option",{value:"LS"},"LS",-1)]),2)),[[j,s(e).jenis]])]),a("div",null,[t[14]||(t[14]=a("label",{for:"anggaran",class:"block font-medium"},"Anggaran (Rp)",-1)),a("input",{type:"text",value:w.value,onInput:t[6]||(t[6]=n=>S(n.target.value)),class:m(["mt-1 block w-full border rounded-md px-3 py-2 text-sm",s(e).errors.anggaran?"border-red-500":"border-gray-300"])},null,42,se)])]),a("div",oe,[t[15]||(t[15]=a("label",{for:"perihal",class:"block font-medium"},[g("Perihal"),a("span",{class:"text-red-600"},"*")],-1)),p(a("input",{type:"text","onUpdate:modelValue":t[7]||(t[7]=n=>s(e).perihal=n),class:m(["mt-1 block w-full border rounded-md px-3 py-2 text-sm",s(e).errors.perihal?"border-red-500":"border-gray-300"])},null,2),[[c,s(e).perihal]])]),a("div",ne,[t[16]||(t[16]=a("label",{for:"lampirans",class:"block font-medium"},"Lampiran (opsional)",-1)),a("input",{type:"file",accept:".pdf",multiple:"",onChange:P,class:"block w-full text-sm text-gray-700 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-indigo-50 file:text-indigo-700 hover:file:bg-indigo-100"},null,32),t[17]||(t[17]=a("p",{class:"mt-1 text-xs text-gray-500"},"PDF (maks. 3MB per file)",-1))]),a("div",re,[h(R,{onClick:f,disabled:s(e).processing},{default:x(()=>t[18]||(t[18]=[g(" Batal ")])),_:1},8,["disabled"]),h(L,{class:m({"opacity-25":s(e).processing}),disabled:s(e).processing},{default:x(()=>[s(e).processing?(i(),_(k,{key:0,icon:"spinner",spin:"",class:"mr-2"})):y("",!0),g(" "+d(s(e).processing?l.isEdit?"Mengupdate...":"Menyimpan...":l.isEdit?"Update":"Simpan"),1)]),_:1},8,["class","disabled"])])],32)])]),_:1},8,["show"])}}};export{ge as default};
