import{x as L,l as A,i as B,A as k,r as I,c as M,o as l,w as h,b as a,h as r,e as c,t as m,u as n,F as j,z as w,d as O,j as g,B as _,f as u,n as y,a as b,y as R,v as $,W as E}from"./app-BFIzMVFd.js";import{_ as W}from"./Modal-By5cnOVT.js";import{P as J}from"./PrimaryButton-DMpJWd03.js";import{_ as q}from"./SecondaryButton-B7RMHXRj.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const G={class:"sm:p-6"},H={class:"text-lg font-semibold mb-4"},Q={key:0,class:"mb-4 p-3 bg-green-100 rounded-md"},X={class:"font-medium"},Y={class:"text-sm text-gray-600"},Z={key:1,class:"mb-4 p-4 bg-red-50 border-l-4 border-red-500"},ee={class:"flex"},ae={class:"ml-3"},te={class:"text-sm font-medium text-red-800"},se={class:"mt-2 text-sm text-red-700"},ne={class:"list-disc pl-5 space-y-1"},oe={class:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4"},ie={class:"mb-4"},le={class:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4"},re={class:"relative"},de={class:"relative"},me=["value"],ue={class:"mb-4"},ge={key:0,class:"mt-2 space-y-2 mb-2"},pe={class:"flex items-center"},ce={class:"text-sm truncate max-w-xs"},be={class:"text-xs text-gray-500 ml-2"},fe=["onClick"],xe={key:1,class:"mt-2"},_e={class:"flex items-center"},ye={href:"#",target:"_blank",class:"text-sm text-blue-600"},ve={class:"flex justify-end gap-2"},Me={__name:"NotaModal",props:{show:Boolean,isEdit:Boolean,notaData:Object,subKegiatan:Object,errors:Object},emits:["close"],setup(p,{emit:S}){const i=p,C=S,e=L({id:"",nomor_nota:"",perihal:"",anggaran:"",tanggal_pengajuan:"",sub_kegiatan_id:"",jenis:"",is_belanja_modal:!1,lampirans:[]}),f=A(null),U=s=>s==null?"":new Intl.NumberFormat("id-ID").format(s),N=B(()=>{if(e.anggaran===null||e.anggaran==="")return"";const s=parseInt(e.anggaran,10);return isNaN(s)?"":s.toLocaleString("id-ID")}),V=s=>{const t=s.replace(/\D/g,"");e.anggaran=t},F=()=>{i.isEdit&&i.notaData?(e.id=i.notaData.id,e.nomor_nota=i.notaData.nomor_nota,e.perihal=i.notaData.perihal,e.anggaran=i.notaData.anggaran,e.tanggal_pengajuan=i.notaData.tanggal_pengajuan,e.jenis=i.notaData.jenis,e.sub_kegiatan_id=i.notaData.sub_kegiatan_id,e.is_belanja_modal=!!i.notaData.is_belanja_modal,f.value=i.subKegiatan):i.subKegiatan&&(e.sub_kegiatan_id=i.subKegiatan.id,f.value=i.subKegiatan)};k(()=>i.show,s=>{s&&F()},{immediate:!0}),k(()=>i.notaData,s=>{s&&i.isEdit&&(e.anggaran=s.anggaran)},{deep:!0}),k(()=>i.subKegiatan,s=>{s&&!i.isEdit&&(e.sub_kegiatan_id=s.id)},{deep:!0});const P=s=>{const d=Array.from(s.target.files).filter(o=>o.size>3*1024*1024?(e.setError("lampirans","Ukuran file melebihi 3MB per file."),!1):!0);d.length>0&&(e.lampirans=[...e.lampirans,...d])},v=()=>{e.reset(),e.clearErrors(),C("close")},z=()=>{const s={nomor_nota:e.nomor_nota,perihal:e.perihal,anggaran:e.anggaran,tanggal_pengajuan:e.tanggal_pengajuan,jenis:e.jenis,sub_kegiatan_id:e.sub_kegiatan_id,is_belanja_modal:e.is_belanja_modal,lampirans:e.lampirans};i.isEdit?e.transform(t=>({...s,_method:"PUT"})).post(route("nota-dinas.update",e.id),{onSuccess:()=>{v(),E.reload({only:["skpd"]})},preserveScroll:!0}):e.transform(()=>s).post(route("nota-dinas.store"),{onSuccess:()=>{v(),E.reload({only:["skpd"]})},preserveScroll:!0})},K=s=>{e.lampirans.splice(s,1)},T=s=>{if(s===0)return"0 Bytes";const t=1024,d=["Bytes","KB","MB"],o=Math.floor(Math.log(s)/Math.log(t));return parseFloat((s/Math.pow(t,o)).toFixed(2))+" "+d[o]},D=B(()=>!i.isEdit||!i.notaData||!i.notaData.lampirans?[]:i.notaData.lampirans.map(s=>({id:s.id,nama_file:s.nama_file,size:s.size})));return(s,t)=>{const d=I("font-awesome-icon");return l(),M(W,{show:p.show,onClose:v,maxWidth:"5xl"},{default:h(()=>[a("div",G,[a("h3",H,m(p.isEdit?"Edit Nota Dinas":"Buat Nota Dinas"),1),f.value?(l(),r("div",Q,[t[9]||(t[9]=a("h4",{class:"text-sm font-medium text-gray-700 mb-1"},"Untuk Sub Kegiatan:",-1)),a("p",X,m(f.value.nama),1),a("p",Y,"Pagu: Rp "+m(U(f.value.pagu)),1)])):c("",!0),Object.keys(n(e).errors).length>0?(l(),r("div",Z,[a("div",ee,[a("div",ae,[a("h3",te," Terdapat "+m(Object.keys(n(e).errors).length)+" kesalahan yang harus diperbaiki ",1),a("div",se,[a("ul",ne,[(l(!0),r(j,null,w(n(e).errors,(o,x)=>(l(),r("li",{key:x},m(o),1))),128))])])])])])):c("",!0),a("form",{onSubmit:O(z,["prevent"])},[g(a("input",{type:"hidden","onUpdate:modelValue":t[0]||(t[0]=o=>n(e).id=o)},null,512),[[_,n(e).id]]),g(a("input",{type:"hidden","onUpdate:modelValue":t[1]||(t[1]=o=>n(e).sub_kegiatan_id=o)},null,512),[[_,n(e).sub_kegiatan_id]]),a("div",oe,[a("div",null,[t[10]||(t[10]=a("label",{for:"nomor_nota",class:"block text-sm font-medium text-gray-700"},[u("Nomor Nota"),a("span",{class:"text-red-600"},"*")],-1)),g(a("input",{type:"text","onUpdate:modelValue":t[2]||(t[2]=o=>n(e).nomor_nota=o),class:y(["mt-1 block w-full border rounded-md px-3 py-2 text-sm",n(e).errors.nomor_nota?"border-red-500":"border-gray-300"])},null,2),[[_,n(e).nomor_nota]])]),a("div",null,[t[11]||(t[11]=a("label",{for:"tanggal_pengajuan",class:"block text-sm font-medium text-gray-700"},[u("Tanggal Pengajuan"),a("span",{class:"text-red-600"},"*")],-1)),g(a("input",{type:"date","onUpdate:modelValue":t[3]||(t[3]=o=>n(e).tanggal_pengajuan=o),class:y(["mt-1 block w-full border rounded-md px-3 py-2 text-sm",n(e).errors.tanggal_pengajuan?"border-red-500":"border-gray-300"])},null,2),[[_,n(e).tanggal_pengajuan]])])]),a("div",ie,[t[12]||(t[12]=a("label",{for:"perihal",class:"block text-sm font-medium text-gray-700"},[u("Perihal"),a("span",{class:"text-red-600"},"*")],-1)),g(a("input",{type:"text","onUpdate:modelValue":t[4]||(t[4]=o=>n(e).perihal=o),class:y(["mt-1 block w-full border rounded-md px-3 py-2 text-sm",n(e).errors.perihal?"border-red-500":"border-gray-300"])},null,2),[[_,n(e).perihal]])]),a("div",le,[a("div",re,[t[13]||(t[13]=a("label",{for:"anggaran",class:"block text-sm font-medium text-gray-700"},[u("Anggaran (Rp)"),a("span",{class:"text-red-600"},"*")],-1)),a("div",de,[a("input",{type:"text",value:N.value,onInput:t[5]||(t[5]=o=>V(o.target.value)),class:y(["mt-1 block w-full border rounded-md px-3 py-2 pr-10 text-sm",n(e).errors.anggaran?"border-red-500":"border-gray-300"])},null,42,me),n(e).anggaran!==null&&n(e).anggaran!==""?(l(),r("button",{key:0,type:"button",onClick:t[6]||(t[6]=o=>n(e).anggaran=null),class:"absolute right-2 top-[7px] text-gray-400 hover:text-gray-600 transition","aria-label":"Clear amount"},[b(d,{icon:"times"})])):c("",!0)])]),a("div",null,[t[15]||(t[15]=a("label",{for:"jenis",class:"block text-sm font-medium text-gray-700"},[u("Jenis Nota"),a("span",{class:"text-red-600"},"*")],-1)),g(a("select",{"onUpdate:modelValue":t[7]||(t[7]=o=>n(e).jenis=o),class:y(["mt-1 block w-full border rounded-md px-3 py-2 text-sm",n(e).errors.jenis?"border-red-500":"border-gray-300"])},t[14]||(t[14]=[a("option",{value:"",disabled:""},"--Pilih jenis--",-1),a("option",{value:"Pelaksanaan"},"Pelaksanaan",-1),a("option",{value:"TU"},"TU",-1),a("option",{value:"LS"},"LS",-1)]),2),[[R,n(e).jenis]])])]),a("div",ue,[g(a("input",{type:"checkbox","onUpdate:modelValue":t[8]||(t[8]=o=>n(e).is_belanja_modal=o),class:"form-checkbox h-4 w-4 text-indigo-600 rounded border-gray-300 focus:ring-indigo-500 transition duration-150 ease-in-out"},null,512),[[$,n(e).is_belanja_modal]]),t[16]||(t[16]=a("span",{class:"text-sm text-gray-800 font-medium select-none"},[u(" Tandai sebagai "),a("span",{class:"text-indigo-600 font-semibold"},"Belanja Modal")],-1))]),a("div",null,[t[17]||(t[17]=a("label",{for:"lampirans",class:"block font-medium"},"Lampiran (opsional)",-1)),a("input",{id:"lampirans",type:"file",accept:".pdf",multiple:"",onChange:P,class:"block w-full text-sm text-gray-700 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-indigo-50 file:text-indigo-700 hover:file:bg-indigo-100"},null,32),t[18]||(t[18]=a("p",{class:"mt-1 text-xs text-gray-500"},"PDF (maks. 3MB per file)",-1)),n(e).lampirans.length>0?(l(),r("div",ge,[(l(!0),r(j,null,w(n(e).lampirans,(o,x)=>(l(),r("div",{key:x,class:"flex items-center justify-between p-2 bg-gray-100 rounded"},[a("div",pe,[b(d,{icon:"file-pdf",class:"text-red-500 mr-2"}),a("span",ce,m(o.name),1),a("span",be,"("+m(T(o.size))+")",1)]),a("button",{type:"button",onClick:ke=>K(x),class:"text-red-500 hover:text-red-700","aria-label":"Remove file"},[b(d,{icon:"times"})],8,fe)]))),128))])):c("",!0),p.isEdit&&D.value.length?(l(),r("div",xe,[(l(!0),r(j,null,w(D.value,(o,x)=>(l(),r("div",{key:o.id,class:"flex items-center justify-between p-2 bg-gray-100 rounded mb-2"},[a("div",_e,[b(d,{icon:"file-pdf",class:"text-red-500 mr-2"}),a("a",ye,m(o.nama_file),1)])]))),128))])):c("",!0)]),a("div",ve,[b(q,{onClick:v,disabled:n(e).processing},{default:h(()=>t[19]||(t[19]=[u(" Batal ")])),_:1},8,["disabled"]),b(J,{disabled:n(e).processing},{default:h(()=>[n(e).processing?(l(),M(d,{key:0,icon:"spinner",spin:"",class:"mr-2"})):c("",!0),u(" "+m(n(e).processing?p.isEdit?"Mengupdate...":"Menyimpan...":p.isEdit?"Update":"Simpan"),1)]),_:1},8,["disabled"])])],32)])]),_:1},8,["show"])}}};export{Me as default};
